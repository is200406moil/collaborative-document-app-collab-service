name: Docker CI/CD Build

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: üìù Checkout code
      uses: actions/checkout@v4

    # 1. –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Java (CI)
    - name: üõ†Ô∏è Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'maven' # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à Maven –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

    - name: üì¶ Maven Build and Tests (CI)
      run: mvn clean install -DskipTests # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
    
    # --- Docker Image Build (CD) ---
    
    - name: üè∑Ô∏è Define Docker Tag
      id: docker_tag
      run: echo "TAG=$(echo ${{ github.sha }} | cut -c1-7)" >> $GITHUB_OUTPUT # –ò—Å–ø–æ–ª—å–∑—É–µ–º 7 —Å–∏–º–≤–æ–ª–æ–≤ —Ö–µ—à–∞ –¥–ª—è —Ç–µ–≥–∞

    - name: üê≥ Login to Docker Hub (–ï—Å–ª–∏ –Ω—É–∂–µ–Ω push)
      # –≠—Ç–æ—Ç —à–∞–≥ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ, –µ—Å–ª–∏ –≤—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø—É—à–∏—Ç—å –æ–±—Ä–∞–∑ –≤ Docker Hub –∏–ª–∏ –¥—Ä—É–≥–æ–π Registry
      # uses: docker/login-action@v3 
      # with:
      #   username: ${{ secrets.DOCKER_USERNAME }}
      #   password: ${{ secrets.DOCKER_PASSWORD }}
      run: echo "Skipping Docker Login for this MVP"

    - name: üèóÔ∏è Build Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: false # –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑, –Ω–æ –Ω–µ –ø—É—à–∏–º (–µ—Å–ª–∏ Render –∑–∞–±–∏—Ä–∞–µ—Ç –µ–≥–æ –ø–æ URL)
        tags: collaborative-document-app:latest, collaborative-document-app:${{ steps.docker_tag.outputs.TAG }} 
        # –í –≤–∞—à–µ–º Dockerfile JAR-—Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
